<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gemini AI Chat</title>
    <!-- 加载样式表 -->
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/animations.css">
    <link rel="stylesheet" href="css/settings.css">
    <!-- 加载Live2D -->
    <script src="https://fastly.jsdelivr.net/gh/oivio-up/live2d-widget@1.5.7/dist/autoload.js"></script>
    <!-- 加载JS模块 -->
    <script src="js/config.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/notion.js"></script>
    <script src="js/notion-debug.js"></script>
    <script src="js/chat.js"></script>
    <!-- 不需要额外的看板娘退出效果脚本 -->
</head>
<body>
    <!-- 导航栏 -->
    <div class="nav-container">
        <div class="nav-brand" onclick="toggleDropdownHint()">
            Gemini AI Assistant
            <div class="dropdown-hint">
                新功能即将到来~٩(˃̶͈̀௰˂̶͈́)و
            </div>
        </div>
        <div class="nav-items">
            <button class="nav-button" onclick="toggleChat()">对话</button>
            <button class="nav-button" onclick="toggleConfig()">设置</button>
        </div>
    </div>

    <!-- 聊天容器部分 -->
    <div id="chat-container">
        <div class="chat-header">
            <span>与 Gemini AI 的对话</span>
            <button class="clear-btn" onclick="clearMessages()" title="清空对话历史">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M3 6h18"></path>
                    <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"></path>
                    <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"></path>
                </svg>
            </button>
        </div>
        <div id="messages">
            <!-- 消息将在此显示，用户和AI消息都可以通过hover时显示的删除按钮删除 -->
        </div>
        <div id="input-container">
            <input type="text" id="user-input" placeholder="输入消息..." onkeypress="handleKeyPress(event)">
            <button class="send-btn" onclick="sendMessage()" title="发送">
                <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"></path>
                </svg>
            </button>
        </div>
    </div>

    <!-- 设置容器部分 -->
    <div id="config-container">
        <div class="settings-container">
            <h3>设置面板</h3>
            
            <!-- Gemini AI 设置 -->
            <div class="settings-section">
                <div class="settings-header" onclick="toggleSection('gemini')">
                    <h4>
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                        </svg>
                        Gemini AI 设置
                    </h4>
                    <svg class="arrow" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                        <path d="M7 10l5 5 5-5z"/>
                    </svg>
                </div>
                <div class="settings-content" id="gemini-section">
                    <div class="settings-field">
                        <label for="api-key">API Key</label>
                        <input type="text" id="api-key" placeholder="输入你的 Gemini API Key">
                    </div>
                    <div class="settings-field">
                        <label for="proxy-url">代理地址</label>
                        <input type="text" id="proxy-url" placeholder="输入 API 代理地址">
                    </div>
                    <div class="settings-field">
                        <label for="custom-prompt">自定义 Prompt</label>
                        <textarea id="custom-prompt" placeholder="在这里输入你的 AI 风格设定..."></textarea>
                    </div>
                </div>
            </div>

            <!-- Notion 设置 -->
            <div class="settings-section">
                <div class="settings-header" onclick="toggleSection('notion')">
                    <h4>
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M3 4h18v2H3V4zm0 7h18v2H3v-2zm0 7h18v2H3v-2z"/>
                        </svg>
                        Notion 脚本设置
                    </h4>
                    <svg class="arrow" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                        <path d="M7 10l5 5 5-5z"/>
                    </svg>
                </div>
                <div class="settings-content" id="notion-section">
                    <div class="settings-field">
                        <label for="notion-token">Notion Token</label>
                        <input type="text" id="notion-token" placeholder="输入你的 Notion API Token">
                    </div>
                    <div class="settings-field">
                        <label for="notion-page-id">页面 ID</label>
                        <input type="text" id="notion-page-id" placeholder="输入 Notion 页面 ID">
                    </div>
                    
                    <!-- 添加调试按钮和结果区域 -->
                    <div class="settings-field">
                        <button class="test-btn" id="test-notion-btn" onclick="testNotionConfig()">测试 Notion 配置</button>
                        <div id="notion-test-result" style="display:none; margin-top:10px; padding:10px; border-radius:5px;"></div>
                    </div>
                    
                    <div class="settings-field">
                        <label>脚本状态</label>
                        <div class="script-status" style="display: flex; align-items: center; gap: 10px; margin-top: 8px;">
                            <span id="notion-status" style="color: #64748b;">未运行</span>
                            <button class="script-btn" onclick="toggleNotionScript()" style="background: #10b981;">
                                启动脚本
                            </button>
                        </div>
                    </div>
                    <p style="color: #64748b; font-style: italic; margin-top: 12px;">
                        使用 Python 服务处理内容并同步到 Notion，支持 LaTeX 数学公式格式化。
                    </p>
                </div>
            </div>

            <!-- 其他设置 -->
            <div class="settings-section">
                <div class="settings-header" onclick="toggleSection('other')">
                    <h4>
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                            <path d="M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                        其他设置
                    </h4>
                    <svg class="arrow" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                        <path d="M7 10l5 5 5-5z"/>
                    </svg>
                </div>
                <div class="settings-content" id="other-section">
                    <p style="color: #64748b; font-style: italic;">更多设置选项即将推出...</p>
                </div>
            </div>

            <div class="settings-footer">
                <button class="cancel-btn" onclick="toggleConfig()">取消</button>
                <button class="save-btn" onclick="saveConfig()">保存</button>
            </div>
        </div>
    </div>

    <!-- 初始化脚本，确保DOM加载后执行 -->
    <!-- 修改初始化脚本部分 -->
<script>
    document.addEventListener("DOMContentLoaded", async function() {
        // 初始化Live2D位置和事件
        const waifu = document.querySelector("#waifu");
        if (waifu) {
            waifu.style.bottom = "0";
            waifu.style.right = "30px";
            
            waifu.addEventListener("click", () => {
                document.getElementById("user-input").focus();
            });
        }
        
        // 加载配置
        if (typeof loadConfig === "function") {
            loadConfig();
        }
        
        // 检查Python服务可用性
        if (typeof checkServerStatus === "function") {
            await checkServerStatus();
        }
    });
</script>
</body>
</html>
